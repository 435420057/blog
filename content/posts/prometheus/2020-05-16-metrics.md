---
title: "深入浅出 Prometheus 四大指标类型"
date: 2020-05-16T15:08:51+08:00
toc: true
draft: true
tags: 
  - prometheus
---

在上一个章节中我们完成了 Prometheus 的基本概念了解和安装，由于考虑到看我博客的估计是开发向的小伙伴居多，因此没有再更深入。而今天本章节将介绍我们开发用的最多的度量指标，并结合实战对 Metrics 进行使用和细节分析。

## 什么是度量指标

> 来自维基百科

度量是指对于一个物体或是事件的某个性质给予一个数字，使其可以和其他物体或是事件的相同性质比较。度量可以是对一物理量（如长度、尺寸或容量等）的估计或测定，也可以是其他较抽象的特质。

简单来讲，也就是数据的量化，形成对应的数据指标。

## Prometheus 的指标格式

在 Prometheus 中，我们的指标表示格式如下：

```
<metric name>{<label name>=<label value>, ...}
```

主体为指标名称和标签组成：

```
api_http_requests_total{method="POST", handler="/eddycjy"}
```

## Prometheus 四大度量指标

```
$ go get github.com/prometheus/client_golang
```

### Counter（计数器）

Counter 类型代表一个累积的指标数据，其单调递增，只增不减。在应用场景中，像是请求次数、错误数量等等，就非常适合用 Counter 来做指标类型，另外 Counter 类型，只有在被采集端重新启动时才会归零。

Counter 类型一共包含两个常规方法，如下：

方法名 | 作用
---|---
Inc | 将计数器递增 1。
Add(float64) | 将给定值添加到计数器，如果设置的值 < 0，则发生错误。



### Gauge（仪表盘）

Gauge 类型代表一个可以任意变化的指标数据，其可增可减。在应用场景中，像是 Go 应用程序运行时的 Goroutine 的数量就可以用该类型来表示，因为其是浮动的数值，并非固定的。

Gauge 类型一共包含六个常规方法，如下：

方法名 | 作用
---|---
Set(float64) | 将仪表设置为任意值。
Inc() | 将仪表增加 1。
Dec() | 将仪表减少 1。
Add(float64) | 将给定值添加到仪表，该值如果为负数，那么将导致仪表值减少。
Sub(float64) | 从仪表中减去给定值，该值如果为负数，那么将导致仪表值增加。
SetToCurrentTime() | 将仪表设置为当前Unix时间（以秒为单位）。

### Histogram（累积直方图）

Histogram 类型将会在一段时间范围内对数据进行采样（通常是请求持续时间或响应大小等等），并将其计入可配置的存储桶（bucket）中，后续可通过指定区间筛选样本，也可以统计样本总数。

简单来讲，也就是在配置 Histogram 类型时，我们会设置分组区间，例如要分析请求的响应时间，我们可以分为 0-100ms，100-500ms，500-1000ms 等等区间段，那么在 metrics 的上报接口中，将会分为多个维度显示统计情况。

Histogram 类型一共包含一个常规方法，如下：

方法名 | 作用
---|---
Observe(float64) | 将一个观察值添加到直方图。

### Summary（摘要）

Summary 类型将会在一段时间范围内对数据进行采样，但是与 Histogram 类型不同的是 Summary 类型将会存储分位数（在客户端进行计算），而不像 Histogram 类型，根据所设置的区间情况统计存储。 

Summary 类型在采样计算后，一共提供三种摘要指标，如下：

- 样本值的分位数分布情况。
- 所有样本值的大小总和。
- 样本总数。

Summary 类型一共包含一个常规方法，如下：

方法名 | 作用
---|---
Observe(float64) | 将一个观察值添加到摘要。



## 度量指标的命名规范

https://prometheus.io/docs/practices/naming/
